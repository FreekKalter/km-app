"use strict";var kmApp=angular.module("kmApp",["ngRoute","kmControllers","kmAnimations","ui.bootstrap"]);kmApp.config(["$routeProvider",function(b,a){var c=new Date();b.when("/input/:date",{templateUrl:"partials/input.html",controller:"kmInput"}).when("/overview/:category/:year/:month",{templateUrl:"partials/overview.html",controller:"kmOverviewController"}).when("/overview/tijden",{redirectTo:"/overview/tijden/"+c.getFullYear()+"/"+(c.getMonth()+1)}).when("/overview",{redirectTo:"/overview/kilometers/"+c.getFullYear()+"/"+(c.getMonth()+1)}).otherwise({redirectTo:"/input/today"})}]);"use strict";var kmControllers=angular.module("kmControllers",[]);kmControllers.controller("kmInput",["$scope","$routeParams","$location","$http",function(g,f,c,e){g.input=true;g.fields=["Begin","Eerste","Laatste","Terug"];$("#datumprik").datepicker({format:"dd-mm-yyyy",forceParse:true,weekStart:1,calendarWeeks:true,autoclose:true,todayHighlight:true});function i(j){j=j.split("");return j.slice(0,2).join("")+"-"+j.slice(2,4).join("")+"-"+j.slice(4,8).join("")}function h(j){var k=new Date();return d(k.getHours())+":"+d(k.getMinutes())}function d(j){return j<10?"0"+j:""+j}g.getState=function(j){e.get("state/"+j).success(function(o){g.form=o;g.original=JSON.parse(JSON.stringify(o));g.form.Date=i(j);var k=g.form.Fields;var n=0;for(var l=0;l<k.length;l++){if(k[l].Km!=0){k[l].Saved=true;n=l}}if(k[0].Km==0){k[0].Km=o.LastDayKm}else{for(var l=n;l<k.length;l++){if(k[l].Km==0){k[l].Km=Math.floor(k[l-1].Km/1000);break}}}for(var l=n;l<k.length;l++){if(k[l].Time==""){k[l].Time=h();break}}var m;if(m!==undefined){setTimeout(function(){b(document.getElementById(m))},100)}})};g.updateTime=function(j){g.form.Fields[j].Time=h()};function a(){var j=f.date;if(j=="today"){var k=new Date();j=d(k.getDate())+d(k.getMonth()+1)+d(k.getFullYear())}return j}g.$watch("form.Date",function(l,j){if(typeof l!="undefined"&&l!=""){var k=l.replace(/-/g,"");g.getState(k)}});g.$watch("form.Fields",function(m,j){if(m==undefined){return}for(var l=0;l<m.length;l++){var n=m[l].Km!=0&&m[l].Km==g.original.Fields[l].Km;var k=m[l].Time!=0&&m[l].Time==g.original.Fields[l].Time;if(n&&k){g.form.Fields[l].Saved=true}else{g.form.Fields[l].Saved=false}}},true);g.save=function(k,p){var n=[];var m=g.original.Fields;var o=g.form.Fields;var j=g.form.Date.replace(/-/g,"");for(var l=0;l<m.length;l++){console.log(m[l].Km,o[l].Km);if(m[l].Km!=o[l].Km||m[l].Time!=o[l].Time){n[n.length]={Name:o[l].Name,Km:o[l].Km,Time:o[l].Time}}}console.log(n);if(n.length>0){e.post("/save/"+j,n).success(function(q){if(n[n.length-1].Name=="Terug"){c.path("/overview")}else{g.getState(j)}})}};g.goTo=function(j){c.path(j)};g.valid=function(j){return g.kmform["{{field}}"].$error.integer};function b(k){k.focus();var j=k.value.length;k.setSelectionRange(j,j)}g.getState(a())}]);kmControllers.controller("kmOverviewController",["$scope","$routeParams","$location","$http","$filter",function(a,b,g,f,d){a.overview=true;if(b.category==="kilometers"){a.kiloActive=true}if(b.category==="tijden"){a.timesActive=true}a.loadData=function(h){var i=["overview",h,b.year,b.month].join("/");if(h===b.category){if(h==="kilometers"){f.get(i).success(function(j){a.kilometers=j})}else{if(h==="tijden"){f.get(i).success(function(j){a.times=j})}}}else{g.path(i)}};a.deleteRow=function(i,h){f.get("delete/"+d("date")(i,"ddMMyyyy")).success(function(j){if(b.category=="tijden"){a.times.splice(h,1)}else{a.kilometers.splice(h,1)}})};a.edit=function(h){var i=d("date")(h,"ddMMyyyy");g.path("/input/"+i)};a.go=function(h){if(h==="next"){g.path(a.next.link)}else{g.path(a.prev.link)}};var e=new Date();if(!(b.month==e.getMonth()+1&&b.year==e.getFullYear())){e.setMonth(b.month-1);e.setFullYear(b.year);e.setMonth(e.getMonth()+1);a.next={date:e,link:["overview",b.category,e.getFullYear(),e.getMonth()+1].join("/")}}var c=new Date();c.setMonth(b.month-1);c.setFullYear(b.year);c.setMonth(c.getMonth()-1);a.prev={date:c,link:["overview",b.category,c.getFullYear(),c.getMonth()+1].join("/")}}]);var INTEGER_REGEXP=/^\-?\d*$/;kmApp.directive("integer",function(){return{require:"ngModel",link:function(b,d,a,c){c.$parsers.unshift(function(f){if(INTEGER_REGEXP.test(f)){var e=b.form.Fields;if(a.id==="Begin"){c.$setValidity("integer",true);return f}if(a.id==="Eerste"){if(f>=e[0].Km){c.$setValidity("integer",true);return f}}if(a.id==="Laatste"){if(f>=e[1].Km){c.$setValidity("integer",true);return f}}if(a.id==="Terug"){if(f>=e[2].Km){c.$setValidity("integer",true);return f}}}c.$setValidity("integer",false);return f})}}});kmApp.directive("ngEnter",function(){return function(c,b,a){b.bind("keydown keypress",function(d){if(d.which===13){c.$apply(function(){c.$eval(a.ngEnter)});d.preventDefault()}})}});"use strict";var kmAnimations=angular.module("kmAnimations",["ngAnimate"]);kmAnimations.animation(".repeated-item",function(){return{enter:function(b,a){b.css("opacity",0);jQuery(b).animate({opacity:1},a);return function(c){if(c){jQuery(b).stop()}}},leave:function(b,a){b.css("opacity",1);jQuery(b).animate({opacity:0},a);return function(c){if(c){jQuery(b).stop()}}},move:function(b,a){b.css("opacity",0);jQuery(b).animate({opacity:1},a);return function(c){if(c){jQuery(b).stop()}}},addClass:function(b,c,a){},removeClass:function(b,c,a){}}});